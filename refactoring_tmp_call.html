<!DOCTYPE html>
<html class="writer-html5" lang="ca" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Temporals per crides &mdash; Introducció a la programació amb Java 2022-23 documentació</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/moistyle.css" type="text/css" />
    <link rel="shortcut icon" href="_static/logoprg.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/translations.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="Quant a aquests documents" href="about.html" />
    <link rel="index" title="Índex" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="Moviment de responsabilitat" href="refactoring_responsabilitat.html" />
    <link rel="prev" title="Moviment de mètodes" href="refactoring_method_movement.html" />
     
    <script class="googleanalytics" src="_static/moiscripts.js"></script>
    <meta name="robots" content="noindex">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Introducció a la programació amb Java
            <img src="_static/logoprg.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                Curs 2022-23
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="basics.html">Elements bàsics de la programació</a></li>
<li class="toctree-l1"><a class="reference internal" href="moduls.html">Mòduls</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitxers.html">Fitxers</a></li>
<li class="toctree-l1"><a class="reference internal" href="poo.html">Programació Orientada a Objectes</a></li>
<li class="toctree-l1"><a class="reference internal" href="adoo.html">Anàlisi i Disseny Orientats a Objectes</a></li>
<li class="toctree-l1"><a class="reference internal" href="bib.html">Biblioteques</a></li>
<li class="toctree-l1"><a class="reference internal" href="cvs.html">Control de versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Validació d'aplicacions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="refactoring.html">Refactoring</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="refactoring_intro.html">Què és el <em>refactoring</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_exemple.html">El lloguer de vehicles</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_method_extraction.html">Extracció de mètodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_method_movement.html">Moviment de mètodes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Temporals per crides</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_responsabilitat.html">Moviment de responsabilitat</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_removetmps.html">Eliminació de variables temporals</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_metodes_lleugers.html">Una funcionalitat per mètode</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_altres.html">Altres passes de refacció</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_conclusions.html">Conclusions</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_exercicis.html">Exercicis de <em>Refactoring</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bd.html">Persistència amb bases de dades</a></li>
<li class="toctree-l1"><a class="reference internal" href="apendix.html">Apèndix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Introducció a la programació amb Java</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="refactoring.html">Refactoring</a></li>
      <li class="breadcrumb-item active">Temporals per crides</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="refactoring_method_movement.html" class="btn btn-neutral float-left" title="Moviment de mètodes" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="refactoring_responsabilitat.html" class="btn btn-neutral float-right" title="Moviment de responsabilitat" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
           <div itemprop="articleBody">
             
  <div class="section" id="temporals-per-crides">
<h1>Temporals per crides<a class="headerlink" href="#temporals-per-crides" title="Permalink to this heading"></a></h1>
<p>En aquesta entrada coneixerem un nou pas de refacció conegut com a
<em>reemplaçament de variable temporal per crida</em>.</p>
<p>Aquest pas de refacció cerca eliminar variables temporals que només són
assignades un cop i substituir-les pel valor assignat allà on calgui.</p>
<p>Per exemple, considera el següent fragment de codi:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">preuBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">quantitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">preuUnitari</span><span class="p">;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">preuBase</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">preuBase</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.90</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">preuBase</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Aquest pas el codificaria com:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">preuBase</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">preuBase</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.90</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">preuBase</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Amb el nou mètode que encapsula l'expressió inicial:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">double</span><span class="w"> </span><span class="nf">preuBase</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">quantitat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">preuUnitari</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La creació del nou mètode és un altre exemple de pas d'<em>extracció de mètode</em>
que hem vist abans.</p>
<p>Es pot argumentar que aquesta transformació resulta en un codi menys eficient
en execució. Podria ser! Él preu base passa a calcular-se múltiples cops en
comptes d'un. En aquest cas, el càlcul és molt lleuger i és possible, fins i
tot, que Java l'optimitzi. Ens podriem trobar, però, amb càlculs més costosos.
Per exemple, un recorregut d'una llista d'elements.</p>
<p>Quin benefici en treurem d'aquest canvi, aparentment a pitjor? Aquest canvi
elimina del codi dependències a variables temporals, amb el que ens facilita
realitzar extraccions de mètodes.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Recordem que l'eficiència en la llegibilitat/modificabilitat del
codi és normalment molt més desitjable que l'eficiència en l'execució de
codi. Abans de decidir-nos per un codi menys llegible justificant-lo amb el
rendiment em execució, és important tenir molt clar com afecta al rendiment
de l'aplicació. Molts cops ens trobarem que el guany de rendiment és molt
petit. D'altres cops veurem que el codi més clar permet optimitzacions a més
alt nivell.</p>
</div>
<p>En el codi que estem treballant, al mètode <code class="docutils literal notranslate"><span class="pre">Client.informe()</span></code> hi trobem la
variable <code class="docutils literal notranslate"><span class="pre">quantitat</span></code> que actuaria com a variable temporal.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">informe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">resultat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Informe de lloguers del client &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 5</span><span class="w">        </span><span class="n">getNom</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 6</span><span class="w">        </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getNif</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;)\n&quot;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Lloguer</span><span class="w"> </span><span class="n">lloguer</span><span class="p">:</span><span class="w"> </span><span class="n">lloguers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos"> 8</span><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">quantitat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// XXX Part d&#39;un exercici previ</span>
</span><span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">        </span><span class="c1">// afegeix lloguers freqüents</span>
<span class="linenos">11</span><span class="w">        </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="w">        </span><span class="c1">// afegeix bonificació per dos dies de lloguer de Luxe</span>
<span class="linenos">14</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getCategoria</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Vehicle</span><span class="p">.</span><span class="na">LUXE</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="linenos">15</span><span class="w">                </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">            </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">        </span><span class="c1">// composa els resultats d&#39;aquest lloguer</span>
<span class="linenos">20</span><span class="w">        </span><span class="n">resultat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;\t&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">21</span><span class="w">            </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getMarca</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">22</span><span class="w">            </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">23</span><span class="w">            </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getModel</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="hll"><span class="linenos">24</span><span class="w">            </span><span class="p">(</span><span class="n">quantitat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;€&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">25</span><span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">quantitat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
</span><span class="linenos">26</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="w">    </span><span class="c1">// afegeix informació final</span>
<span class="linenos">29</span><span class="w">    </span><span class="n">resultat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;Import a pagar: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;€\n&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">30</span><span class="w">        </span><span class="s">&quot;Punts guanyats: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">31</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resultat</span><span class="p">;</span>
<span class="linenos">32</span><span class="p">}</span>
</pre></div>
</div>
<p><img alt="exerciseicon__T" src="_images/exerciseicon__T.png" /> <a class="reference internal" href="exercici_52_19_temporal.html"><span class="doc"> Exercici 52_19. Extracció de quantitat</span></a></p>
</div>


           </div>
          </div>
    <div class="googleanalytics">
    <div id="cookiesbox">
        Aquest lloc web utilitza galetes (<i>cookies</i>) per a analitzar el seu ús
        amb les eines que ofereix <a href="https://www.google.com/analytics">Google Analytics</a>.
        En continuar navegant-hi, estàs acceptant-ho.
        <br/>
        <a class="btn btn-neutral" onclick="setUserAcceptsCookies();">
            Tancar
            <span class="fa fa-window-close"></span>
        </a>
    </div>
    <script>setCookiesboxVisibility();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41103782-2', 'auto');
      ga('send', 'pageview');
    </script>
</div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="refactoring_method_movement.html" class="btn btn-neutral float-left" title="Moviment de mètodes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="refactoring_responsabilitat.html" class="btn btn-neutral float-right" title="Moviment de responsabilitat" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2023 Moisès Gómez Girón.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41103782-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-41103782-2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>